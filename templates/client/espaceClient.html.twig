{% extends 'base.html.twig' %}

{% from 'shared/macro.html.twig' import delete_form %}

{% set confirmMessage = "Etes-vous sûr de vouloir annuler cette demande ?" %}
{% set status = 'text-secondary' %}

{% if demande is not null %}
	{% set commande = demande.commande %}
	{% if demande.statusDoc != constant('App\\Entity\\Demande::DOC_VALID') %}
		{% set status = 'text-success' %}
	{% elseif demande.statusDoc != constant('App\\Entity\\Demande::DOC_PENDING') or demande.statusDoc != constant('App\\Entity\\Demande::DOC_UNCOMPLETED') %}
		{% set status = 'text-warning' %}
	{% elseif demande.statusDoc != constant('App\\Entity\\Demande::DOC_NONVALID') %}
		{% set status = 'text-danger' %}
	{% elseif demande.statusDoc != constant('App\\Entity\\Demande::DOC_RECEIVE_VALID') %}
		{% set status = 'text-primary' %}
	{% else %}
		{% set status = 'text-secondary' %}
	{% endif %}
{% endif %}

{% block page_content %}
	<div class="esp_clientBlock content-wrapper" id="esp_clientBlock">
		<div class="container">
			<div class="row">
				<div class="comment-ca-marche-texte col-md-12 col-lg-12 col-xs-12">
					{{ include('client/layout/menu.html.twig') }}
					<h4 class="mt-5 title-client">Demarche:</h4>
					<div class="demarche-container p-0" id="custom-tab">
						<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
							<li class="nav-item">
								<a class="nav-link active" id="pills-document-tab" data-toggle="pill" href="#pills-document" role="tab" aria-controls="pills-document" aria-selected="false">
									<i class="icon-mail-send"></i>
									<span class="d-none d-md-block">J'envoie mes documents</span>
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" id="pills-document-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-document" aria-selected="false">
									<i class="icon-more-options"></i>
									<span class="d-none d-md-block">Détails de la commande</span>
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" id="pills-apercu-tab" data-toggle="pill" href="#pills-apercu" role="tab" aria-controls="pills-apercu" aria-selected="true">
									<i class="icon-eye"></i>
									<span class="d-none d-md-block">Aperçu</span>
								</a>
							</li>
						</ul>
						{% if demande is not null %}
							<div class="tab-content" id="pills-tabContent">
								<div class="content-demarche tab-pane fade" id="pills-apercu" role="tabpanel" aria-labelledby="pills-apercu-tab">
									{{ include('demande/suivi.html.twig') }}
									<hr>
									<p>
										{% if demande.transaction is not null and demande.transaction.id is defined %}
											{{demande.transaction.id | number_format()}}
										{% elseif demande.commande.transaction is not null and demande.commande.transaction.id is defined %}
											{{demande.commande.transaction.id | number_format()}}
										{% endif %}
										{{demande.dateDemande | date('Ym')}}/{{demande.commande.demarche.type}}-{{demande.id}}
										:{{ demande.commande.demarche.nom }}
									</p>
									<p>Créée le
										{{ demande.commande.ceerLe | date('d.m.Y à H\\h:i')}}</p>
									<p>Immatriculation :
										{{ demande.commande.immatriculation | displayValue}}</p>
									<p>Département :
										{{ demande.commande.codePostal | displayValue}}</p>
									<p>
										Dossier à deposer en ligne:
										<span class="badge badge-{{ statusOfCommande(demande.commande, " style") }}">
											{{ statusOfCommande(demande.commande, "text") }}
										</span>
									</p>
									<!-- <p>Dossier à envoyer par courier: A expédier / Reçu</p> -->
								</div>
								<div class="content-demarche tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
									<p>{{ demande.commande.demarche.nom }}
										<br>
										{{ demande.commande.ceerLe | date('d.m.Y à H\\h:i')}}</p>
									<p>Votre commande expire le
										<span>{{ demande.commande.ceerLe |date_modify("+1 month")|date('d.m.Y à H\\h:i')}}</span>
									</p>

									<a href="{{path('payment_facture', {'demande':demande.id})}}" target="_blank" class="btn btn-aqua-blue btn-facture">Facture<i class="icon-pdf"></i>
									</a>
									<div class="block_CCM menu-faq pt-2 pb-1">
										<div
											class="comment-ca-marche-texte">

											<!--A quoi sert le certificat d’immatriculation ?-->
											<div class="accordeon_ ml-md-3">
												<div class="row">
													<button type="button" class="col-12 col-sm-6 col-md-7 menu-commander">
														<span class="menu-commander--button---text" style="font-weight:200; !important">RÉTRACTATION</span>
													</button>
													<div class="toggle-content col-12" style="display: none;">
														<div id="Changement-de-titulaire" class="row commander">
															<div class="commander-box">
																<div class="commander-box--section---description mt-3">
																	<div class="piece_fournir">
																		<div id="daf-list-wrapper" class="mb-2">
																			<span>RÉTRACTATION :</span><br><br>
																			<span>Les acheteurs, personnes physiques non professionnelles, bénéficient d'un délai de 14 jours à compter de leur commande pour se rétracter. Pour ce faire, le Client souhaitant se rétracter devra le faire par le biais du formulaire de rétractation dûment rempli qui devra être, pour être pris en compte, adressé à l'adresse mentionnée sur le formulaire. Le Prestataire prend en charge les frais de retour des produits commandés. A défaut de mention contraire et expresse du Client souhaitant se rétracter, le remboursement sera effectué suivant le même mode de paiement que celui utilisé par ce dernier pour la passation de la commande et interviendra au plus tard dans les 14 jours à compter de la date à laquelle le Vendeur sera informé de la décision du Client de se rétracter.</span><br><br>
																			<span>En application de l'article L.221-28 du Code de la Consommation, le droit de rétractation ne peut être exercé pour les contrats :</span><br><br>
																			<span>De fourniture de services pleinement exécutés avant la fin du délai de rétractation et dont l'exécution a commencé après accord préalable exprès du consommateur et renoncement exprès à son droit de rétractation
                                                                            De fourniture de biens confectionnés selon les spécifications du consommateur ou nettement personnalisés
                                                                            Conformément à l'article L.221-25 du Code de la Consommation, le Client-consommateur devra renoncer expressément à son droit de rétractation en application de l’article L.221-28 du Code de la Consommation, pour obtenir le service commandé et/ou le produit personnalisé commandé dans les meilleurs délais, avant la confirmation de sa commande afin de permettre au Prestataire de traiter la demande sans délais. Faute de renonciation expresse au droit de rétractation avant la commande, celle-ci ne deviendra ferme et définitive qu'après l'expiration du délai de rétractation.</span><br><br>
																			<span>En cas de rétractation du client avant l’envoi des documents nécessaires au traitement du dossier, la commande sera annulée et le client sera remboursé des taxes fiscales suivant les conditions énoncées ci-dessus.</span><br><br>
																			<span>En cas de rétractation du client après réception de son dossier par les services de la société CG Officiel, la commande sera annulée et le client sera remboursé des taxes fiscales déduites des frais de gestion et des frais de traitement de dossier.</span><br><br>
																			<span>CAS D’ANNULATIONS ET DE REMBOURSEMENTS HORS RÉTRACTATION :</span><br><br>
																			<span>En cas d’annulation d’une commande à la demande du client, au-delà du 14ème jour à compter de la passation de la commande, les frais équivalant au montant des prestations Carte Grise seront facturés par le Prestataire.</span><br><br>
																			<span>En cas d’annulation d’une commande à la demande du client, au-delà d’un mois à compter de la passation de la commande et après relances personnalisées restées infructueuses, les frais de gestion équivalant au montant des prestations Carte Grise seront facturés par le Prestataire.</span><br><br>
																			<span>Le remboursement (total ou partiel, en dehors de l'exercice du droit de rétractation) s'effectue dans un délai maximum de 14 jours ouvrables par CB ou, 30 jours ouvrables par chèque à l'ordre de la personne ou de la raison sociale stipulée dans les coordonnées de la facturation, à compter de la réception de la demande d'annulation ou du retour des marchandises.</span><br><br>
																			<span>Tout remboursement de taxe suite à une erreur du client dans le calcul de la taxe régionale seront effectués dans un délai maximum de 14 jours ouvrables à compter du jour d'envoi de la carte grise provisoire (CPI) / accusé d'enregistrement (AE) par CB ou par chèque à l'ordre de la personne ou de la raison sociale stipulée dans les coordonnées de la facturation.</span><br><br>
																			<span>Pour tout remboursement d’un trop perçu de taxe régionale, les frais de gestion seront appliqués aux tarifs suivants :</span><br><br>
																			<ul>
                                                                                <li>Des frais de gestion de 9,90€ seront appliqués pour tous remboursements de taxe compris entre 1,00€ et 100,00€</li>
																				<li>Des frais de gestion de 19,90€ seront appliqués pour tous remboursements de taxe compris entre 100,01€ et 200,00€</li>
																				<li>Des frais de gestion de 29,90€ seront appliqués pour tous remboursements de taxe à partir de 200,01€.</li>
																				
																			</ul>
                                                                            <span>Les éventuels frais de gestion générés par une annulation de commande ou un écart de taxe seront déduits des remboursements opérés par la société CG Officiel.</span>
																		</div>
																	</div>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="content-demarche tab-pane fade show active" id="pills-document" role="tabpanel" aria-labelledby="pills-document-tab" style="overflow: auto;">
									<div>
										<h4>Finalisez votre démarche</h4>
										<a class="no-underline" href="{{path('demande_dossiers_a_fournir', {id: demande.id })}}">
											<button type="button" class="btn btn-aqua-blue btn-primary btn-sm">Pièces à fournir<i class="icon-right-arrow"></i>
											</button>
										</a>
										{% for col in form %}
											{% if col.vars.type is defined and col.vars.type == 'file' %}
												<div class="group-input">
													<div>
														<p>
															{% set name = checkFile(files, col.vars.name) %}
															{% if name == "" %}
																<span class="text-secondary">{{ form_label(col) }}</span>
															{% else %}
																<span class="{{ status }}">{{ form_label(col) }}</span>
															{% endif %}
															{% if name != "" %}
																<small>
																	<a href="{{ asset(name) }}" target="_blank">
																		<button class="btn btn-sm btn-outline-info">
																			<i class="far fa-eye"></i>
																			Voir
																		</button>
																	</a>
																</small>
															{% endif %}
														</p>
													</div>
												</div>
											{% endif %}
										{% endfor %}
									</div>
								</div>
							</div>
							{%else%}

							<div class="tab-content">
								<p>Aucune demande trouvée</p>
							</div>
							{%endif%}
						</div>
					</div>
				</div>
			</div>
		</div>

	{% endblock %}

	{% block javascripts %}
		{{ parent() }}
		<script src="{{ asset('asset/libs/js/popper.min.js') }}" type="text/javascript"></script>
		<script src="{{ asset('asset/libs/js/bootstrap.min.js') }}" type="text/javascript"></script>
		<script type="text/javascript">
			$(function () {
$('[data-toggle="popover"]').popover();
});
		</script>
		<script type="text/javascript">
			$(".menu-commander").on("click", function () {
if ($(this).hasClass("active")) {
$(this).removeClass("active");
$(this).siblings(".toggle-content").slideUp(200);
} else {
$(".menu-commander").removeClass("active");
$(this).addClass("active");
$(".toggle-content").slideUp(200);
$(this).siblings(".toggle-content").slideDown(200);
}
});
		</script>
	{% endblock %}
